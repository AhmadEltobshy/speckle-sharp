<UserControl x:Class="Speckle.DesktopUI.Streams.AllStreamsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Speckle.DesktopUI.Streams"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:s="https://github.com/canton7/Stylet"
             xmlns:utils="clr-namespace:Speckle.DesktopUI.Utils"
             d:DesignHeight="450"
             d:DesignWidth="600"
             mc:Ignorable="d">
  <UserControl.Resources>
    <ResourceDictionary>
      <utils:InverseBooleanConverter x:Key="InverseBooleanConverter" />
      <DataTemplate x:Key="StreamCardTemplate">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <!--#region Disabled because no account-->
          <Grid Grid.Row="0"
                Margin="24"
                Panel.ZIndex="2"
                Visibility="{Binding Client, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}">
            <Border Width="260"
                    Height="Auto"
                    Background="{DynamicResource MaterialDesignTextFieldBoxDisabledBackground}"
                    CornerRadius="6">
              <StackPanel Margin="8"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center">
                <TextBlock FontSize="14"
                           Text="No local account for server:"
                           TextWrapping="Wrap" />
                <TextBlock Margin="0,4"
                           FontFamily="Consolas"
                           Text="{Binding ServerUrl}"
                           TextWrapping="Wrap" />
                <TextBlock
                  Text="Please ensure you have an account for this server and have added it to the Speckle Manager"
                  TextWrapping="Wrap" />
              </StackPanel>
            </Border>
          </Grid>
          <md:Card Grid.Row="0"
                   Width="Auto"
                   Margin="8"
                   Panel.ZIndex="1"
                   md:ShadowAssist.ShadowDepth="Depth0"
                   Foreground="{DynamicResource MaterialDesignTextFieldBoxDisabledBackground}"
                   Opacity=".9"
                   UniformCornerRadius="8"
                   Visibility="{Binding Client, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}" />
          <!--#endregion-->
          <md:Card Grid.Row="0"
                   Width="Auto"
                   Margin="8"
                   md:ShadowAssist.ShadowDepth="Depth0"
                   UniformCornerRadius="8">
            <Grid Margin="16">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
              </Grid.RowDefinitions>
              <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="56" />
                  <ColumnDefinition Width="40" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           VerticalAlignment="Center"
                           FontSize="18"
                           Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                           Text="{Binding Stream.name}"
                           TextWrapping="Wrap" />
                <Button x:Name="SendStreamButton"
                        Grid.Column="1"
                        Margin="8,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Command="{s:Action Send}"
                        CommandParameter="{Binding}"
                        Content="{md:PackIcon Kind=CloudUpload,
                                        Size=20}"
                        IsEnabled="{Binding IsReceiving, Converter={StaticResource InverseBooleanConverter}}"
                        Style="{StaticResource FlatFloatingActionMiniButton}"
                        ToolTip="Send objects to Speckle"
                        Visibility="{Binding IsSending, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}" />
                <Button x:Name="StopSendButton"
                        Grid.Column="1"
                        Margin="8,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        md:ButtonProgressAssist.IsIndeterminate="False"
                        md:ButtonProgressAssist.IsIndicatorVisible="True"
                        md:ButtonProgressAssist.Maximum="{Binding Progress.Maximum, Mode=OneWay}"
                        md:ButtonProgressAssist.Value="{Binding Progress.Value, Mode=OneWay}"
                        Command="{s:Action CancelToken}"
                        Content="{md:PackIcon Kind=Stop,
                                        Size=20}"
                        Style="{StaticResource FlatFloatingActionMiniButton}"
                        ToolTip="Cancel the send operation"
                        Visibility="{Binding IsSending, Converter={x:Static s:BoolToVisibilityConverter.Instance}}" />
                <md:Badged Grid.Column="1"
                           Margin="48,5,0,0"
                           Badge="{Binding Placeholders.Count}"
                           BadgeColorZoneMode="Accent"
                           ToolTip="objects to send"
                           Visibility="{Binding Placeholders.Count, Converter={x:Static s:BoolToVisibilityConverter.Instance}, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                <Button x:Name="ReceiveButton"
                        Grid.Column="2"
                        Margin="0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Command="{s:Action Receive}"
                        CommandParameter="{Binding}"
                        Content="{md:PackIcon Kind=CloudDownload,
                                        Size=20}"
                        IsEnabled="{Binding IsSending, Converter={StaticResource InverseBooleanConverter}}"
                        Style="{StaticResource FlatFloatingActionMiniDarkButton}"
                        ToolTip="Receive changes from Speckle"
                        Visibility="{Binding IsReceiving, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}" />
                <Button x:Name="StopReceiveButton"
                        Grid.Column="2"
                        Margin="0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        md:ButtonProgressAssist.IsIndeterminate="False"
                        md:ButtonProgressAssist.IsIndicatorVisible="True"
                        md:ButtonProgressAssist.Maximum="{Binding Progress.Maximum, Mode=OneWay}"
                        md:ButtonProgressAssist.Value="{Binding Progress.Value, Mode=OneWay}"
                        Command="{s:Action CancelToken}"
                        Content="{md:PackIcon Kind=Stop,
                                        Size=20}"
                        Style="{StaticResource FlatFloatingActionMiniDarkButton}"
                        ToolTip="Cancel the receive operation"
                        Visibility="{Binding IsReceiving, Converter={x:Static s:BoolToVisibilityConverter.Instance}}" />
                <md:Badged Grid.Column="2"
                           Margin="40,5,0,0"
                           Badge="{md:PackIcon Kind=ExclamationThick}"
                           BadgeColorZoneMode="Accent"
                           ToolTip="there are new updates on the server"
                           Visibility="{Binding ServerUpdates, Converter={x:Static s:BoolToVisibilityConverter.Instance}}" />
              </Grid>

              <Grid Grid.Row="1">
                <StackPanel Orientation="Vertical">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <md:Chip Grid.Column="0"
                             Height="28"
                             md:ButtonAssist.CornerRadius="14"
                             Command="{s:Action CopyStreamId}"
                             CommandParameter="{Binding Stream.id}"
                             FontFamily="Consolas"
                             FontSize="12"
                             ToolTip="Stream ID">
                      <StackPanel Orientation="Horizontal">
                        <md:PackIcon Width="12"
                                     Height="12"
                                     Margin="0,0,4,0"
                                     VerticalAlignment="Center"
                                     Kind="ContentCopy" />
                        <TextBlock Text="{Binding Stream.id}" />
                      </StackPanel>
                    </md:Chip>

                    <Grid Grid.Column="2"
                          Margin="0,18,0,12"
                          VerticalAlignment="Center">
                      <StackPanel Orientation="Horizontal">
                        <md:PackIcon Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Kind="CubeOutline" />
                        <TextBlock Margin="0,0,12,0"
                                   Foreground="{DynamicResource MaterialDesignColumnHeader}"
                                   Text="{Binding Objects.Count, StringFormat=' {0} objects'}" />
                        <md:PackIcon Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Kind="History"
                                     ToolTip="commits on master branch" />
                        <TextBlock Margin="4,0,12,0"
                                   Foreground="{DynamicResource MaterialDesignColumnHeader}"
                                   Text="{Binding Stream.branches.items[0].commits.items.Count}" />
                        <md:PackIcon Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Kind="Accounts"
                                     ToolTip="collaborators" />
                        <TextBlock Margin="4,0,12,0"
                                   Foreground="{DynamicResource MaterialDesignColumnHeader}"
                                   Text="{Binding Stream.collaborators.Count}" />
                        <md:PackIcon Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Margin="0,0,6,0"
                                     Kind="Link"
                                     ToolTip="link sharing is on"
                                     Visibility="{Binding Stream.isPublic, Converter={x:Static s:BoolToVisibilityConverter.Instance}}"/>
                        <md:PackIcon Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Margin="0,0,6,0"
                                     Kind="LinkLock"
                                     ToolTip="link sharing is off"
                                     Visibility="{Binding Stream.isPublic, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}"/>
                      </StackPanel>
                    </Grid>
                  </Grid>
                </StackPanel>
              </Grid>

              <Grid Grid.Row="2"
                    Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <!--  <TextBlock  -->
                <!--  Grid.Column="0"  -->
                <!--  Margin="0,12"  -->
                <!--  FontSize="10"  -->
                <!--  Text="{Binding DataContext, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />  -->
                <Button Grid.Column="0"
                        Width="Auto"
                        md:ButtonAssist.CornerRadius="4"
                        Command="{s:Action ShowStreamInfo}"
                        CommandParameter="{Binding}"
                        Content="DETAILS"
                        Style="{StaticResource SoftFlatButton}" />
                <StackPanel Grid.Column="3"
                            Orientation="Horizontal">
                  <!--<Button Width="28"
                  Height="28"
                  md:RippleAssist.ClipToBounds="True"
                  Content="{md:PackIcon Kind=Heart,
                  Size=18}"
                  Style="{StaticResource MaterialDesignIconButton}" />-->
                  <!--<Button x:Name="ShareStreamButton"
                        Width="28"
                        Height="28"
                        md:RippleAssist.ClipToBounds="True"
                        Command="{s:Action ShowShareDialog}"
                        CommandParameter="{Binding}"
                        Content="{md:PackIcon Kind=ShareVariant,
                                        Size=18}"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="Share this stream!" />-->
                  <Button Width="28"
                          Height="28"
                          md:RippleAssist.ClipToBounds="True"
                          Command="{s:Action OpenStreamInWeb}"
                          CommandParameter="{Binding}"
                          Content="{md:PackIcon Kind=OpenInNew,
                                          Size=18}"
                          Style="{StaticResource MaterialDesignIconButton}"
                          ToolTip="Open this stream in the browser" />
                </StackPanel>
              </Grid>
            </Grid>
          </md:Card>
        </Grid>
      </DataTemplate>

    </ResourceDictionary>
  </UserControl.Resources>

  <Grid>
    <Grid Margin="0,0,0,100">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>
      <!--<ProgressBar
        Grid.Row="0"
        Margin="0,0,0,10"
        Background="Transparent"
        BorderThickness="0"
        Foreground="{DynamicResource PrimaryHueLightBrush}"
        IsIndeterminate="False"
        Maximum="{Binding Progress.Maximum, Mode=OneWay}"
        Value="{Binding Progress.Value, Mode=OneWay}" />-->
      <!--<TextBlock Grid.Row="1"
                 Padding="5,0,5,10"
                 HorizontalAlignment="Left"
                 FontSize="24"
                 Style="{StaticResource MaterialDesignHeadline3TextBlock}"
                 Text="STREAMS" />-->

      <ScrollViewer Grid.Row="2"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemTemplate="{StaticResource StreamCardTemplate}"
                      ItemsSource="{Binding StreamList, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
      </ScrollViewer>
    </Grid>

    <!--  TODO absolute positioning rel to window  -->

    <Button x:Name="CreateStreamButton"
            Width="45"
            Height="45"
            Margin="32"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Command="{s:Action ShowStreamCreateDialog}"
            Content="{md:PackIcon Kind=Plus,
                            Size=24}"
            DockPanel.Dock="Bottom"
            Style="{StaticResource FlatFloatingActionAccentButton}"
            ToolTip="Add a stream"
            ToolTipService.Placement="Left" />
  </Grid>

</UserControl>