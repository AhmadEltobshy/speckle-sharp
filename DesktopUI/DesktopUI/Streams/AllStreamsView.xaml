<UserControl x:Class="Speckle.DesktopUI.Streams.AllStreamsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Speckle.DesktopUI.Streams"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:s="https://github.com/canton7/Stylet"
             xmlns:utils="clr-namespace:Speckle.DesktopUI.Utils"
             d:DesignHeight="450"
             d:DesignWidth="600"
             mc:Ignorable="d">
  <UserControl.Resources>
    <ResourceDictionary>
      <utils:InverseBooleanConverter x:Key="InverseBooleanConverter" />
      <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
      <ControlTemplate x:Key="BranchButton">
        <Button x:Name="BranchButton"
                Width="auto"
                MaxWidth="110"
                md:ButtonAssist.CornerRadius="3"
                ContextMenuService.Placement="Bottom"
                FontSize="11"
                Style="{StaticResource MaterialDesignToolForegroundButton}"
                
                ToolTip="Edit/Change branch">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <md:PackIcon Grid.Column="0"
                         Kind="SourceBranch" />
            <TextBlock Grid.Column="1"
                       Margin="1,2"
                       HorizontalAlignment="Center"
                       Text="Branch:" />
            <TextBlock Grid.Column="2"
                       Margin="1,2"
                       FontWeight="Bold"
                       Text="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=DataContext.Stream.name}" />
          </Grid>
        </Button>
      </ControlTemplate>
      
      <DataTemplate x:Key="StreamCardTemplate">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <!--#region Disabled because no account-->
          <Grid Grid.Row="0"
                Margin="24"
                Panel.ZIndex="2"
                Visibility="{Binding Client, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}">
            <Border Width="260"
                    Height="Auto"
                    Background="{DynamicResource MaterialDesignTextFieldBoxDisabledBackground}"
                    CornerRadius="6">
              <StackPanel Margin="8"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center">
                <TextBlock FontSize="14"
                           Text="No local account for server:"
                           TextWrapping="Wrap" />
                <TextBlock Margin="0,4"
                           FontFamily="Consolas"
                           Text="{Binding ServerUrl}"
                           TextWrapping="Wrap" />
                <TextBlock Text="Please ensure you have an account for this server and have added it to the Speckle Manager"
                           TextWrapping="Wrap" />
              </StackPanel>
            </Border>
          </Grid>
          <md:Card Grid.Row="0"
                   Width="Auto"
                   Margin="8"
                   Panel.ZIndex="1"
                   md:ShadowAssist.ShadowDepth="Depth0"
                   Foreground="{DynamicResource MaterialDesignTextFieldBoxDisabledBackground}"
                   Opacity=".9"
                   UniformCornerRadius="8"
                   Visibility="{Binding Client, Converter={x:Static s:BoolToVisibilityConverter.InverseInstance}}" />
          <!--#endregion-->

          <md:Card Grid.Row="0"
                   Width="Auto"
                   Margin="12,10,12,10"
                   md:ShadowAssist.ShadowDepth="Depth0"
                   UniformCornerRadius="8">
            <Grid Margin="16">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
              </Grid.RowDefinitions>

              <Grid Name="StreamCardTitle"
                    Grid.Row="0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="56" />
                  <ColumnDefinition Width="40" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           VerticalAlignment="Center"
                           FontSize="18"
                           Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                           Text="{Binding Stream.name}"
                           TextWrapping="Wrap" />

                <Button Grid.Column="1"
                        Width="28"
                        Height="28"
                        HorizontalAlignment="Right"
                        md:RippleAssist.ClipToBounds="True"
                        Command="{s:Action OpenStreamInWeb}"
                        CommandParameter="{Binding}"
                        Content="{md:PackIcon Kind=OpenInNew,
                                        Size=18}"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="Open this stream in the browser" />

                <Button Grid.Column="2"
                        Width="28"
                        Height="28"
                        ContextMenuService.Placement="Bottom"
                        HorizontalAlignment="Right"
                        md:RippleAssist.ClipToBounds="True"
                        Content="{md:PackIcon Kind=MoreVert,
                                        Size=18}"
                        ToolTip="More options">
                  <Button.Style>
                    <Style TargetType="{x:Type Button}"
                           BasedOn="{StaticResource MaterialDesignIconButton }">
                      <Style.Triggers>
                        <EventTrigger RoutedEvent="Click">
                          <EventTrigger.Actions>
                            <BeginStoryboard>
                              <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetProperty="ContextMenu.IsOpen">
                                  <DiscreteBooleanKeyFrame KeyTime="0:0:0"
                                                           Value="True" />
                                </BooleanAnimationUsingKeyFrames>
                              </Storyboard>
                            </BeginStoryboard>
                          </EventTrigger.Actions>
                        </EventTrigger>
                      </Style.Triggers>
                      <Setter Property="ContextMenu">
                        <Setter.Value>
                          <ContextMenu>
                            <MenuItem />
                            <MenuItem />
                          </ContextMenu>
                        </Setter.Value>
                      </Setter>
                    </Style>
                  </Button.Style>
                  <Button.ContextMenu>
                    <ContextMenu>
                      <MenuItem Header="Remove"
                                Foreground="Red">
                        <MenuItem.Icon>
                          <md:PackIcon Kind="Trash" />
                        </MenuItem.Icon>
                      </MenuItem>
                    </ContextMenu>
                  </Button.ContextMenu>
                </Button>
              </Grid>

              <Grid Name="StreamCardSenderActions"
                    Grid.Row="1"
                    Margin="0,30,0,0"
                    Visibility="{Binding IsSenderCard, Converter={StaticResource BooleanToVisibilityConverter}}"
                    >
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <!--The branch button-->
                <Control Template="{StaticResource BranchButton}"></Control>
                <!--Selection Filter Button-->
                <Button x:Name="SelectionFilterButton"
                        Grid.Column="1"
                        Width="auto"
                        MaxWidth="120"
                        Margin="0,0,5,0"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action ShowStreamUpdateObjectsDialog}"
                        CommandParameter="{Binding}"
                        FontSize="11"
                        Style="{StaticResource MaterialDesignToolForegroundButton}"
                        ToolTip="Edit/Change Objects">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <md:PackIcon Grid.Column="0"
                                 Kind="CubeOutline" />

                    <TextBlock Grid.Column="1"
                               Margin="3,2"
                               HorizontalAlignment="Center"
                               Text="Objects: " />
                    <TextBlock Grid.Column="2"
                               Margin="0,2"
                               FontWeight="Bold"
                               Text="100" />
                  </Grid>
                </Button>
                <!--The Send Button-->
                <Button x:Name="SendButton"
                        Grid.Column="2"
                        Width="110"
                        HorizontalAlignment="Right"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action ShowStreamInfo}"
                        CommandParameter="{Binding}"
                        FontSize="11"
                        ToolTip="Send objects to Speckle.">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <md:PackIcon Grid.Column="1"
                                 Kind="CloudUpload" HorizontalAlignment="Right"/>

                    <TextBlock Grid.Column="0"
                               Margin="3,2"
                               HorizontalAlignment="Center"
                               Text="Send    " />
                  </Grid>
                </Button>
                <!--The state swapper button-->
                <Button x:Name="SwapStateButton"
                        Grid.Column="3"
                        Width="30"
                        Margin="5,0,0,0"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action SwapState}"
                        CommandParameter="{Binding}"
                        FontSize="10"
                        Style="{StaticResource MaterialDesignToolForegroundButton}"
                        ToolTip="Receive data from this stream.">
                  <md:PackIcon Kind="CloudDownload" />
                </Button>
              </Grid>

              <Grid x:Name="StreamCardReceiverActions"
                    Grid.Row="2"
                    Margin="0,30,0,0"
                    Visibility="{Binding IsReceiverCard, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Control Template="{StaticResource BranchButton}"></Control>
                <Button x:Name="CommitButton"
                        Grid.Column="1"
                        Width="auto"
                        MaxWidth="110"
                        Margin="0,0,10,0"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action ShowStreamInfo}"
                        CommandParameter="{Binding}"
                        FontSize="11"
                        Style="{StaticResource MaterialDesignToolForegroundButton}"
                        ToolTip="Select Commit">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <md:PackIcon Grid.Column="0"
                                 Kind="SourceCommit" />
                    <TextBlock Grid.Column="1"
                               Margin="3,2"
                               HorizontalAlignment="Center"
                               Text="Latest" />
                    <TextBlock Grid.Column="2"
                               Margin="0,2"
                               FontWeight="Bold"
                               Text="061459c4f2" />
                  </Grid>
                </Button>
                <Button x:Name="ReceiveButton"
                        Grid.Column="2"
                        Width="110"
                        HorizontalAlignment="Right"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action ShowStreamInfo}"
                        CommandParameter="{Binding}"
                        FontSize="11"
                        Style="{StaticResource MaterialDesignRaisedDarkButton}"
                        ToolTip="Edit/Change Objects">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <md:PackIcon Grid.Column="1"
                                 Kind="CloudDownload" />

                    <TextBlock Grid.Column="0"
                               Margin="3,2"
                               HorizontalAlignment="Center"
                               Text="Receive    " />
                  </Grid>
                </Button>
                <Button x:Name="SwapStateButton2"
                        Grid.Column="3"
                        Width="30"
                        Margin="5,0,0,0"
                        md:ButtonAssist.CornerRadius="3"
                        Command="{s:Action SwapState}"
                        CommandParameter="{Binding}"
                        FontSize="10"
                        Style="{StaticResource MaterialDesignToolForegroundButton}"
                        ToolTip="Send data to this stream.">
                  <md:PackIcon Kind="CloudUpload" />
                </Button>
              </Grid>
            </Grid>
          </md:Card>
        </Grid>
      </DataTemplate>

    </ResourceDictionary>
  </UserControl.Resources>

  <md:TransitioningContent OpeningEffect="{md:TransitionEffect FadeIn}">
    <Grid Margin="0">
      <Grid Margin="0,8,0,0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="2"
                      VerticalAlignment="Stretch"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">
          <ItemsControl ItemTemplate="{StaticResource StreamCardTemplate}"
                        ItemsSource="{Binding StreamList, Mode=OneWay, UpdateSourceTrigger=Default}" />
        </ScrollViewer>

      </Grid>

      <!--Big add button-->
      <Canvas>
        <Button x:Name="CreateStreamButton"
                Canvas.Right="0"
                Canvas.Bottom="0"
                Width="45"
                Height="45"
                Margin="32"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                md:ShadowAssist.ShadowDepth="Depth3"
                Command="{s:Action ShowStreamCreateDialog}"
                Content="{md:PackIcon Kind=Plus,
                                Size=24}"
                DockPanel.Dock="Bottom"
                Style="{StaticResource FlatFloatingActionButton}"
                ToolTip="Add a stream"
                ToolTipService.Placement="Left" />
      </Canvas>

    </Grid>
  </md:TransitioningContent>

</UserControl>